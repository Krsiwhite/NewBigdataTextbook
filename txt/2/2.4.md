### 2.4.2 HBase基础操作实践

**（1）操作环境**

&emsp;&emsp;服务器规格： Ubuntu 24.04 server 64bit 节点数⽬：3

&emsp;&emsp;Hadoop 版本： Apache Hadoop 3.3.6

&emsp;&emsp;zookeeper 版本： 3.8.4

&emsp;&emsp;HBase 版本： 2.5.11

**（2）操作步骤**

**1.启动 Hadoop、HBase 及 zookeeper：**

&emsp;&emsp;在 **所有节点** 都运⾏ `zkServer.sh start` 以启动 zookeeper;

&emsp;&emsp;在 **节点 m1**运⾏ `start-all.sh` 以启动 Hadoop集群;

&emsp;&emsp;启动后⽤ `zkServer.sh status` 和 `jps` 命令检查各个服务是否正常启动;

**2.使⽤ HBase Shell连接 HBase：**

&emsp;&emsp;在 **节点 m1**运⾏ `start-hbase.sh` 启动 HBase 服务；

&emsp;&emsp;运⾏ `hbase shell` 进⼊ hbase shell, 接下来关于 hbase的数据操作命令都是在 hbase shell中执⾏。

**3.HBase 操作：**

&emsp;&emsp;创建表 student，设置 2个列簇，分别为 stuinfo 和 course，并显示表结构:

```shell
# 创建表 
create 'student',{NAME=>'stuinfo'},{NAME=>'course'}

#查看表结构
describe 'student' 
``` 

&emsp;&emsp;修改表结构，course 列簇返回最⼤版本数为 3，并显示表结构：

```shell
# 修改表结构
alter 'student',{NAME=>'course',VERSIONS=>3} 

describe 'student'
```

&emsp;&emsp;向列簇中增加列：
```shell
stuinfo 列簇: name,age,sex,dept 
course 列簇: english,math,physics
```
&emsp;&emsp;由于 HBase是采⽤动态添加列，在插⼊数据的同时插⼊列，因此步骤 3 和步骤 4 统⼀放在步骤 4 完成。

&emsp;&emsp;向表中添加数据，添加四条学⽣信息:

```shell
put 'student','1','stuinfo:name','laowang' 
put 'student','1','stuinfo:age','18'
put 'student','1','stuinfo:sex','male'
put 'student','1','stuinfo:dept','CS'
put 'student','1','course:english','100' 
put 'student','1','course:math','90'
put 'student','1','course:physics','80'
put 'student','2','stuinfo:name','chris' 
put 'student','2','stuinfo:age','36'
put 'student','2','stuinfo:sex','male' 
put 'student','2','stuinfo:dept','CS' 
put 'student','2','course:english','90' 
put 'student','2','course:math','80'
put 'student','2','course:physics','100'
```

&emsp;&emsp;Note: 由于命令过多且格式相同，故只列出部分命令，都按照 `put 表名, ⾏号, 列簇: 列名, 数据` 
的格式插⼊数据。<p align="center">
    <img src="/pic/2/2-4 学生表.png" width="50%">
    <br/>
    <em>图2-4 学生信息表</em>
</p>

&emsp;&emsp;添加完数据后，⽤ scan 命令查询 student 表中的所有信息：
```shell
# 查询表信息
scan 'student' 
```

&emsp;&emsp;添加完数据后，查询 student 表中指定列簇或列簇中某个列的所有信息：
```shell
# 查询 stuinfo 列簇中的所有信息 
scan 'student', {COLUMN=>'stuinfo'} 

# 查询 stuinfo:sex 列中的所有信息
scan 'student', {COLUMN=>'stuinfo:sex'} 

# 通过 LIMIT 限定查询到的⾏数
scan 'student', {LIMIT=>2, COLUMN=>'stuinfo'} 
```

&emsp;&emsp;更新数据，将 course 列簇中的 english 列的值减 5：
```shell
put 'student','1','course:english','95'
```
&emsp;&emsp;Note：HBase ⽆法统⼀修改数据，只能⼀个个数据重新赋值。

&emsp;&emsp;使⽤ get 查询指定⾏对应列簇或列的信息：
```shell
# 查询第 "1" ⾏ course列簇的信息
get 'student', '1', 'course' 

# 查询第 "1"⾏ course列簇中 english列的信息
get 'student', '1', 'course:english'  

# 查询第 "1"⾏中所有信息
get 'student, '1' 
```

&emsp;&emsp;删除 student 表：
```shell
# 先使表失效，才能删除
disable 'student' 

# 删除表
drop 'student'
```